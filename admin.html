<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Pizzaria Maluca</title>
    <style>
        /* Base de estilo para qualquer dispositivo */
        body { background: #121212; font-family: sans-serif; margin: 0; padding: 0; }
        
        .admin-container { 
            padding: 15px; 
            max-width: 600px; 
            margin: auto; 
            color: white; 
            box-sizing: border-box;
        }

        header { text-align: center; margin-bottom: 20px; position: relative; }
        
        .btn-logout { 
            background: #e74c3c; 
            color: white; 
            border: none; 
            padding: 8px 15px; 
            border-radius: 5px; 
            cursor: pointer; 
            position: absolute;
            right: 0;
            top: 0;
            font-size: 14px;
        }

        .status-badge { 
            padding: 15px; 
            text-align: center; 
            border-radius: 5px; 
            margin-bottom: 20px; 
            font-weight: bold; 
            text-transform: uppercase;
            font-size: 14px;
        }

        .aberto { background: #2ecc71; box-shadow: 0 0 10px rgba(46, 204, 113, 0.3); }
        .fechado { background: #e74c3c; box-shadow: 0 0 10px rgba(231, 76, 60, 0.3); }

        .form-group { margin-bottom: 15px; display: flex; flex-direction: column; }
        
        label { font-size: 14px; margin-bottom: 5px; color: #aaa; }

        input, select { 
            padding: 12px; 
            border-radius: 5px; 
            border: 1px solid #333; 
            background: #2a2a2a; 
            color: white; 
            font-size: 16px; /* Evita zoom automático no iPhone */
        }

        .grid-precos {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .btn-salvar { 
            background: #2ecc71; 
            color: white; 
            padding: 18px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            width: 100%; 
            font-weight: bold; 
            margin-top: 20px; 
            font-size: 16px;
            transition: 0.2s;
        }

        .btn-salvar:active { transform: scale(0.98); }

        h3 { 
            margin-top: 25px; 
            border-bottom: 1px solid #333; 
            padding-bottom: 5px; 
            font-size: 18px;
            color: #e74c3c;
        }

        /* Ajuste para telas muito pequenas */
        @media (max-width: 400px) {
            .grid-precos { grid-template-columns: 1fr; }
            .btn-logout { position: static; width: 100%; margin-bottom: 15px; }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <header>
            <button class="btn-logout" onclick="logout()">Sair</button>
            <img src="img/pizzas/LOGO PIZZA.png" width="80" style="margin-top: 10px;">
            <h1 style="font-size: 22px;">Painel de Controle</h1>
        </header>

        <div id="status-atual" class="status-badge">Carregando...</div>

        <form id="form-admin">
            <div class="form-group">
                <label>Status da Loja:</label>
                <select id="statusLoja">
                    <option value="aberto">Aberta (Aceitando Pedidos)</option>
                    <option value="fechado">Fechada (Apenas Visualização)</option>
                </select>
            </div>

            <div class="form-group">
                <label>WhatsApp (com DDD):</label>
                <input type="text" id="whatsapp" placeholder="Ex: 5511999999999">
            </div>

            <div class="form-group">
                <label>Taxa de Entrega (R$):</label>
                <input type="number" step="0.01" id="taxaEntrega">
            </div>

            <h3>Preços das Pizzas (R$)</h3>
            <div class="grid-precos">
                <div class="form-group"><label>Pizza P:</label><input type="number" step="0.01" id="precoP"></div>
                <div class="form-group"><label>Pizza M:</label><input type="number" step="0.01" id="precoM"></div>
                <div class="form-group"><label>Pizza G:</label><input type="number" step="0.01" id="precoG"></div>
                <div class="form-group"><label>Pizza F:</label><input type="number" step="0.01" id="precoF"></div>
            </div>

            <button type="button" class="btn-salvar" onclick="salvarConfiguracoes()">SALVAR ALTERAÇÕES</button>
        </form>
    </div>

    <script>
        /* SEGURANÇA */
        if (localStorage.getItem('admin_logado') !== 'true') {
            window.location.href = "login.html";
        }

        function logout() {
            localStorage.removeItem('admin_logado');
            window.location.href = "login.html";
        }

        /* CONEXÃO API */
        const API_URL = "https://pizzaria-maluca.onrender.com/api/config";

        async function carregarDados() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                
                document.getElementById('statusLoja').value = data.statusLoja;
                document.getElementById('whatsapp').value = data.whatsapp;
                document.getElementById('taxaEntrega').value = data.taxaEntrega;
                document.getElementById('precoP').value = data.precos.P;
                document.getElementById('precoM').value = data.precos.M;
                document.getElementById('precoG').value = data.precos.G;
                document.getElementById('precoF').value = data.precos.F;

                const badge = document.getElementById('status-atual');
                badge.innerText = `Loja está: ${data.statusLoja}`;
                badge.className = `status-badge ${data.statusLoja}`;
            } catch (error) {
                console.error("Erro ao carregar dados:", error);
            }
        }

        async function salvarConfiguracoes() {
            const btn = document.querySelector('.btn-salvar');
            btn.innerText = "SALVANDO...";
            btn.disabled = true;

            const config = {
                statusLoja: document.getElementById('statusLoja').value,
                whatsapp: document.getElementById('whatsapp').value,
                taxaEntrega: parseFloat(document.getElementById('taxaEntrega').value),
                precos: {
                    P: parseFloat(document.getElementById('precoP').value),
                    M: parseFloat(document.getElementById('precoM').value),
                    G: parseFloat(document.getElementById('precoG').value),
                    F: parseFloat(document.getElementById('precoF').value)
                }
            };

            try {
                const res = await fetch(`${API_URL}/atualizar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                if(res.ok) {
                    alert("Dados salvos com sucesso!");
                    carregarDados();
                }
            } catch (error) {
                alert("Erro ao salvar! Tente novamente.");
            } finally {
                btn.innerText = "SALVAR ALTERAÇÕES";
                btn.disabled = false;
            }
        }

        window.onload = carregarDados;
    </script>
</body>
</html>